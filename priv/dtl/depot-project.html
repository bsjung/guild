{% extends "base.html" %}

{% block styles %}
<link href="/assets/css/widgets.css" rel="stylesheet">
<link href="/assets/css/depot.css" rel="stylesheet">
{% endblock %}

{% block navbar_menu %}
{% include "depot-navbar.html" %}
{% endblock %}

{% block page_content %}
<div class="row project-header">
  <div class="col-md-12">
    <div class="pull-left">
      <h1 class="project">
        <span class="project-account"><a href="/{{p.account.name}}">{{p.account.name}}</a></span><span class="path-sep">/</span><span class="project-name"><a href="/{{p.path}}">{{p.name}}</a></span>
      </h1>
      <div class="project-desc">{{p.description}}</div>
    </div>
    <div class="project-actions pull-right">
      {% if env.user %}
      <a class="btn btn-star {% if p.starred %}btn-success{% else %}btn-default{% endif %}"
         data-toggle="tooltip"
         title="{% if p.starred %}You starred this project<br>(click to unstar){% else %}Click to star this project{% endif %}"
         href="/{{p.path}}?{% if p.starred %}unstar{% else %}star{% endif %}">
        <i class="fa fa-star fa-fw"></i> {% if p.starred %}Starred{% else %}Star{% endif %}
        <span class="badge badge-count">{{p.stars_count}}</span>
      </a>
      {% else %}
      <span
         data-toggle="tooltip"
         title="Login to star this project">
        <a class="btn btn-star btn-default"
           role="button"
           tabindex="0"
           data-toggle="popover"
           data-trigger="focus"
           data-placement="bottom"
           data-content="Please <a href='javascript:guild.auth.login()'>login</a> to star this project"
           href="#">
          <i class="fa fa-star fa-fw"></i> Star
          <span class="badge badge-count">{{p.stars_count}}</span>
        </a>
      </span>
      {% endif %}
      <!-- TODO
      <a class="btn btn-default" href="/view/{{p.path}}">Open in Guild View</a>
      -->
    </div>
  </div>
</div>
<div class="row">
  <div class="col-lg-9">
    <div class="p-meta">
      {% for tag in p.tags %}
      <span class="p-tag badge" style="background-color:{{tag|tag_color}}">
        <a href="/?t={{tag}}">{{tag}}</a>
      </span>
      {% endfor %}
      <span style="white-space:nowrap">
      <span class="p-updated">updated {{p.updated|format_updated:now_seconds}}</span>
      </span>
    </div>
    <ul class="nav nav-tabs guild-tabs">
      <li role="presentation" class="{% if active_tab == 'readme' %}active{% endif %}"><a href="?readme">README.md</a></li>
      <li role="presentation" class="{% if active_tab == 'guild' %}active{% endif %}"><a href="?guild">Guild</a></li>
    </ul>
    <div class="guild-tabs-body">
      {% if active_tab == 'readme' %}
        {% autoescape off %}
          {% with readme_html=p|depot_project_readme_html %}
            {% if readme_html %}
            {{readme_html}}
            {% else %}

      This project does not have a README. Create a file named
      <code>README.md</code> in the project directory and re-publish your project.

            {% endif %}
          {% endwith %}
        {% endautoescape %}
      {% elif active_tab == 'guild' %}
      <pre>{{p|depot_project_source:'Guild'}}</pre>
      {% endif %}
    </div>
  </div>
  <div class="col-lg-3">
    <div class="panel-fields">
      <div class="caption">
        <span class="caption-main">Runs</span>
        <!--
        <span class="caption-helper"></span>
        -->
      </div>
      <div class="p-runs">
        <div class="table-responsive">
          <table class="table">
            <tr>
              <th>Date</th><th>Model</th><th>Status</th>
            </tr>
            {% for run in p.runs %}
            <tr>
              <td>{{run.date}}</td><td>{{run.model}}</td><td>{{run.status}}</td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
      {# TODO?
      <div class="fields">
        {% for field in p.fields %}
        <div class="panel panel-widget mdc-bg-{{field.color}}">
          <div class="panel-heading">
            <div class="row">
              <div class="col-xs-3 label-icon-col">
                <i class="fa fa-{{field.icon}} fa-fw label-icon"></i>
              </div>
              <div class="col-xs-9 text-right">
                <div class="label-value label-value-default">
                  <span>{{field.value}}</span>
                </div>
                <div class="label-caption">{{field.caption}}</div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
        <div style="margin-top:-5px"><a href="/view/{{p.path}}">View stats for all runs</a></div>
      </div>
      #}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
 $(function() {
     guild.depot.baseInit();
     {% if not env.user %}
     $("a.btn-star").popover({"html": true});
     {% endif %}
 });
</script>
{% endblock %}
