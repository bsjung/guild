<link rel="import" href="../guild-component-panel/guild-component-panel.html">
<link rel="import" href="../vz-line-chart/vz-line-chart.html">

<dom-module id="guild-chart">
  <template>
    <style>
     #container {
         background-color: #fff;
         padding: 20px 10px 20px 0;
         height: 260px;
         display: flex;
         align-items: stretch;
     }
     vz-line-chart {
         --vz-chart-tooltip: {
             border-radius: 2px;
             background-color: var(--paper-tooltip-background, #616161);
         }
     }
    </style>
    <guild-component-panel heading="[[title]]">
      <div id="container">
        <vz-line-chart id="chart"></vz-line-chart>
      </div>
    </guild-component-panel>
  </template>
  <script>
   Polymer({
       is: "guild-chart",

       properties: {
           title: String,
           dataSource: String
       },

       ready: function() {
           var runId = this.env.selectedRun.id;
           var url = "/data/" + this.dataSource + "?run=" + runId;
           Guild.Data.fetch(url, function(data) {
               var chart = this.$.chart;
               var names = Object.keys(data);
               chart.setVisibleSeries(names);
               names.map(function(name) {
                   var values = data[name];
                   var seriesData = values.map(function(item, index) {
                       return {
                           wall_time: new Date(item[0]),
                           step: item[1] || index,
                           scalar: item[2]
                       }
                   });
                   chart.setSeriesData(name, seriesData);
               }.bind(this));
           }.bind(this));
       }
   });
  </script>
</dom-module>
